*На даний момент надається єдиний спосіб встановлення та роботи - всередині докер з установкою через wca-tool.*       

## Встановлення
Виконайте команду 
```shell
sudo wca-tool --key=YOUR_AGENT_KEY install 
```
*YOUR_AGENT_KEY - ключ агента, який ви отримали при зверненні (див. вимоги)*
Процес встановлення займає деякий час (зазвичай 10-15 хвилин).   

У випадку успішного встановлення - буде відображено повідомлення
```shell
WildcoreDMS success installed!
Now, you can use wildcoreDMS by URL: http://<service ip|domain>:8088
Default login/password - admin/admin

You can change some parameters in /opt/wildcore-dms/.env file, as listen ports for example
```

Після встановлення перейти в веб-панель.    
За замовчуванням панель доступна на порту `8088`, а дефотлний логін/пароль для входу - admin/admin.   


## Часті проблеми при встановленні
### Не встановлений docker-compose-plugin 
Зазвичай помилка виглядає таким чином:       
![](assets/no-docker-compose-plugin.jpg)

Вимагається, щоб в системі був встановлений docker-compose як плагін до докеру, а не як окрема утиліта.    

Щоб усунути проблему:

1. Встановіть пакет `docker-compose-plugin` для вашої ОС(дивіться інструкцію встановлення в офіційній документації docker - [docs.docker.com](https://docs.docker.com/engine/install/))
2. Перевірте, що він дійсно працює - команда `docker compose version` повинна повертати версію плагіна.
3. Продовжте встановлення  wildcoreDMS командою ```sudo wca-tool update```    

### Агент відключений     
Після успішного встановлення, при спробі  входу - відображаєьбся повідомлення
![](assets/agent-disabled.png)     
Дана проблема може бути зв'язана з встановленням системи на "слабкі" сервери (меньше, ніж вказано в рекомендаціях)         
Вирішується наступним чином: 

1. Чекаємо хвилин 5-10 (повинна запуститися СУБД. Можна також прослідкувати за запуском команди `docker logs -f wca-db`)
2. Виконуємо команду `docker exec -it wca composer install`
3. Виконуємо команду `wca migration:migrate --up *:*`
   1. Якщо в процесі виконання команди отримали пов'язану з підключенням до БД (наприклад, Connection refused) – повертаємось до пункту 1
4. Виконуємо команду `wca system:check`
5. Пробуємо повторно увійти через веб-інтерфейс 


### Помилки пов'язані з мережею
Може виявлятися записами в логах типу: `Connection refused`, `Connection timeout`, `Forbidden`    

Рекомендовані дії: 

1. Прочитати з логів, куди саме робиться спроба підключитись  
2. Упевниться що з сервера ця адреса доступна (перевірити тим же curl доступність у разі HTTP)     
   1. Якщо з відповіддю все добре - перевірити, що все добре з докером (встановлений за офіційною докою, не було старих версій та встановлена версія саме під вашу систему)

Після усунення проблеми доустановку можна виконати командою `wca-tool update`.
    
## Види збоїв установки 
### Не повна установка
Може виникати в наступних випадках:    

* Проблеми з роботою докер або плагіна (недостатньо прав, не встановлені необхідні версії, стара версія тощо)
* Проблеми зі стартом СУБД (зазвичай супроводжується помилкою від PHP - `Connection refused`)   
* Проблеми з мережею (недоступні образи докеру, проблеми з підключенням до реліз-сервера)

Переконайтеся, що установка не повна можна переглянувши наявність файлів у каталозі `/opt/wildcore-dms`, 
зокрема наявність файлу `/opt/wildcore-dms/.uuid`

Слід усунути проблему та виконати команду:  
```shell
sudo wca-tool update 
```
для повноцінної установки

### Повне скасування 
Може виникати в наступних випадках:    

* Проблеми з мережею (недоступність API wildcore, реліз-сервера)
* Некоректний ключ агента
* Недостатньо прав
* Немає необхідного програмного забезпечення (наприклад - curl, docker)

Переконатися, що установку було скасовано, можна перевірити наявність файлу `/opt/wildcore-dms/.uuid`.       
Якщо файл або каталог відсутній - установку було скасовано. 

Після усунення проблем слід повторити встановлення, командою 
```shell
sudo wca-tool --key=YOUR_AGENT_KEY install 
```
